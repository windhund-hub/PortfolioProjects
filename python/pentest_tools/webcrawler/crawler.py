#!/usr/bin/env python

import requests
import re
from urllib.parse import urljoin

url = "https://nmap.org/"
target_links = []

def request(url):
    try:
        return requests.get(url)
    except:
        pass

def subdomain_discovery():
    with open("/home/thename/Dokumente/subdomain.list", "r") as wordlist_file:
            for line in wordlist_file:
                word = line.strip()
                url_to_test = word + "." + url
                response = request(url_to_test)
                if response:
                    print("[+] subdomain entdeckt: " + url_to_test)

def directory_discovery(url):
    with open("/home/thename/Dokumente/subdomain.list", "r") as wordlist_file:
        for line in wordlist_file:
            word = line.strip()
            url_to_test = url + "/" + word
            response = request(url_to_test)
            if response:
                print("[+] URL entdeckt: " + url_to_test)

# für all(default) alle Möglichkeiten ausgeben
# z.B. comments, forms suchen und z.b. in separate Datei schreiben
def crawl_links(url):
    response = request(url)
    pattern = re.compile('(?:href=")(.*?)"', re.IGNORECASE)
    return re.findall(pattern, response.content.decode('utf-8', 'ignore'))

def crawl_comments(url):
    response = request(url)
    return re.findall('<!--(.*?)-->', response.content.decode('utf-8'))

def check_for_scope(target, link):
    if target in link and link not in target_links:
        target_links.append(link)
        print(link)
        crawl(link)

def crawl(target):
    print('Diese Seite wird gerade gecrawlt: ' + target)
    href_links = crawl_links(target)
    print('Diese Links wurden gefunden: ' + str(len(href_links)))
    for link in href_links:
        if '#' in link:
            link = link.split('#')[0]
        if link.startswith('http'):
            check_for_scope(target,link)
        else:
            link = url + link
            check_for_scope(url,link)

    #comments = crawl_comments(url)
    #for comment in comments:
     #   print(comment)

crawl(url)